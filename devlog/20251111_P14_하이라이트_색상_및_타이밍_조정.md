# 20251111 P14: 하이라이트 색상 및 타이밍 조정

## 개요

Matrix 클러스터링 진행 과정의 하이라이트 색상을 통일하고, 병합 후 일시적으로만 하이라이트 표시하도록 변경.

## 요구사항

1. **프리뷰 색상 변경**: 빨간색 → 노란색
2. **병합 후 하이라이트**: 노란색으로 0.5초 표시
3. **하이라이트 제거**: 0.5초 후 하얀색(일반)으로 변경

## 변경 사항

### Before (이전)

```
Step 진행:
1. Next 클릭
2. 프리뷰: 빨간색으로 0.5초 표시 (J, T 행/열)
3. 병합 완료: 노란색으로 계속 표시 (J+T 행/열)
4. 다음 step으로 가도 노란색 유지
```

**문제점:**
- ❌ 프리뷰(빨간색)와 병합 후(노란색) 색이 다름
- ❌ 병합된 클러스터가 계속 노란색으로 남아 있음
- ❌ 여러 병합이 쌓이면 혼란스러움

### After (현재)

```
Step 진행:
1. Next 클릭
2. 프리뷰: 노란색으로 0.5초 표시 (J, T 행/열) ← 변경
3. 병합 완료: 노란색으로 0.5초 표시 (J+T 행/열) ← 유지
4. 0.5초 후: 하얀색으로 변경 ← 추가
```

**개선점:**
- ✅ 프리뷰와 병합 후 모두 노란색으로 통일
- ✅ 병합 후 0.5초만 하이라이트
- ✅ 이후 하얀색으로 돌아가 깔끔

## 구현

### 1. 상태 변수 변경

**acc_gui.py - StepMatrixWidget.__init__()**

**Before:**
```python
self.is_preview_mode = False  # Preview mode
self.preview_clusters = None  # (idx_i, idx_j) to highlight
```

**After:**
```python
self.highlight_merged = False  # Whether to highlight just-merged cluster
self.merged_cluster_idx = None  # Index of just-merged cluster
```

`is_preview_mode`와 `preview_clusters`는 여전히 사용하지만, 추가로 병합 후 하이라이트를 위한 변수 추가.

### 2. 프리뷰 색상 변경

**acc_gui.py - StepMatrixWidget.populate_table()**

**Before:**
```python
if self.is_preview_mode and self.preview_clusters:
    highlight_indices = self.preview_clusters
    highlight_color = Qt.GlobalColor.red  # 빨간색
else:
    # ... merged cluster logic
    highlight_color = Qt.GlobalColor.yellow
```

**After:**
```python
highlight_color = Qt.GlobalColor.yellow  # 항상 노란색

if self.is_preview_mode and self.preview_clusters:
    # Preview mode: yellow
    highlight_indices = self.preview_clusters
elif self.highlight_merged and self.merged_cluster_idx is not None:
    # Just-merged mode: yellow
    highlight_indices = (self.merged_cluster_idx,)
```

### 3. 병합 완료 후 타이밍 추가

**acc_gui.py - StepMatrixWidget._complete_next_step()**

**Before:**
```python
def _complete_next_step(self):
    self.is_preview_mode = False
    self.preview_clusters = None
    self.step_slider.setValue(self.current_step + 1)
```

**After:**
```python
def _complete_next_step(self):
    # Move to next step
    self.is_preview_mode = False
    self.preview_clusters = None
    self.step_slider.setValue(self.current_step + 1)

    # Highlight merged cluster in yellow
    if self.step_manager and self.current_step > 0:
        step_info = self.step_manager.get_step(self.current_step)
        labels = step_info['labels']

        # Find the first merged cluster (tuple/list)
        for idx, label in enumerate(labels):
            if isinstance(label, (tuple, list)):
                self.merged_cluster_idx = idx
                self.highlight_merged = True
                self.update_step_display()

                # After 500ms, remove highlight
                QTimer.singleShot(500, self._remove_highlight)
                break
```

### 4. 하이라이트 제거 메서드 추가

**acc_gui.py - StepMatrixWidget._remove_highlight()**

```python
def _remove_highlight(self):
    """Remove yellow highlight from merged cluster"""
    self.highlight_merged = False
    self.merged_cluster_idx = None
    self.update_step_display()
```

## 동작 흐름

### Step 0 → Step 1 전환

```
타임라인:
┌─────────────────────────────────────────────────┐
│ T=0.0s: Next 버튼 클릭                          │
│   ↓                                             │
│ T=0.0~0.5s: 프리뷰 (노란색)                    │
│   Matrix:                                       │
│      J    T    Y    N    O    Q                 │
│   J  -   🟡  🟡  🟡  🟡  🟡   ← J 행 노란색    │
│   T  🟡   -   🟡  🟡  🟡  🟡   ← T 행 노란색    │
│   Y  🟡  🟡   -    ...                          │
│      ↑   ↑                                      │
│    J열 T열 노란색                               │
├─────────────────────────────────────────────────┤
│ T=0.5s: 병합 완료                               │
│   ↓                                             │
│ T=0.5~1.0s: 병합 후 하이라이트 (노란색)        │
│   Matrix:                                       │
│      J+T  Y    N    O    Q                      │
│   J+T  -  🟡  🟡  🟡  🟡   ← J+T 행 노란색     │
│   Y   🟡   -    ...                             │
│   N   🟡  ...                                   │
│       ↑                                         │
│     J+T열 노란색                                │
├─────────────────────────────────────────────────┤
│ T=1.0s: 하이라이트 제거                         │
│   ↓                                             │
│ T=1.0s~: 일반 표시 (하얀색)                    │
│   Matrix:                                       │
│      J+T  Y    N    O    Q                      │
│   J+T  -   0.8  0.39 0.34 0.35  ← 하얀색       │
│   Y   0.8   -   0.37 0.32 0.33                  │
│   N   0.39 0.37  -   0.75 0.75                  │
│       ...                                       │
└─────────────────────────────────────────────────┘
```

## 색상 통일의 장점

### Before (빨간색 + 노란색)

```
프리뷰: 빨간색 → "경고? 에러?"
병합 후: 노란색 → "완료?"

사용자: "빨간색은 뭐고 노란색은 뭐지? 🤔"
```

### After (노란색 통일)

```
프리뷰: 노란색 → "강조"
병합 후: 노란색 → "강조"

사용자: "노란색은 현재 진행 중인 병합! 👍"
```

## 일시적 하이라이트의 장점

### Before (계속 표시)

```
Step 1: J+T 노란색
Step 2: J+T 노란색, O+Q 노란색
Step 3: J+T+Y 노란색, N 노란색, O+Q 노란색
...

모든 병합된 클러스터가 노란색 → 혼란스러움 ❌
```

### After (일시적 표시)

```
Step 1: J+T 노란색 (0.5초) → 하얀색
Step 2: O+Q 노란색 (0.5초) → 하얀색
Step 3: J+T+Y 노란색 (0.5초) → 하얀색
...

현재 병합만 노란색, 나머지는 하얀색 → 명확! ✓
```

## 타이밍 설계

### 프리뷰: 0.5초
- 사용자가 "어떤 클러스터가 병합되는지" 확인할 시간
- 너무 짧지도, 길지도 않음

### 병합 후 하이라이트: 0.5초
- 사용자가 "병합 결과"를 확인할 시간
- 프리뷰와 동일한 타이밍으로 일관성

### 총 1초
- Next 버튼 클릭 → 1초 후 다음 단계로 완전히 전환
- 적절한 속도: 너무 빠르지도, 느리지도 않음

## 사용자 경험

### 시나리오 1: 단계별 진행

```
사용자: Next 클릭

0.0s: "아, J와 T가 노란색이네. 이 둘이 병합되는구나."
0.5s: "병합 완료! J+T가 노란색으로 표시되네."
1.0s: "이제 하얀색으로 돌아갔어. 다음 단계로 넘어가자."

사용자: Next 클릭 (Step 2)

0.0s: "O와 Q가 노란색. 이번엔 이 둘이 병합."
0.5s: "O+Q 완성!"
1.0s: "깔끔하게 정리됐네."
```

### 시나리오 2: 빠른 진행

```
사용자: Next를 빠르게 여러 번 클릭

Step 1: J+T 병합 → 0.5초 후 하얀색
Step 2: O+Q 병합 → 0.5초 후 하얀색
Step 3: J+T+Y 병합 → 0.5초 후 하얀색

각 병합이 독립적으로 하이라이트되어 추적 가능 ✓
```

## 코드 변경 요약

| 메서드 | 변경 사항 |
|--------|-----------|
| `__init__` | `highlight_merged`, `merged_cluster_idx` 추가 |
| `prev_step` | 하이라이트 플래그 초기화 |
| `_complete_next_step` | 병합 후 하이라이트 + 0.5초 타이머 |
| `_remove_highlight` | 새로 추가: 하이라이트 제거 |
| `populate_table` | 색상 노란색 통일, 조건 간소화 |

## 테스트

```bash
$ python acc_gui.py
# Load sample_local.csv
# Click Next button repeatedly
```

**확인 항목:**
1. ✅ 프리뷰: 노란색으로 0.5초 표시
2. ✅ 병합 후: 노란색으로 0.5초 표시
3. ✅ 0.5초 후: 하얀색으로 변경
4. ✅ 다음 step에서 이전 병합은 하얀색 유지
5. ✅ 색상이 일관되게 노란색만 사용

## 추가 개선 가능성

### 1. 타이밍 조정 가능하게

```python
PREVIEW_DURATION = 500  # ms
HIGHLIGHT_DURATION = 500  # ms

# 설정에서 조정 가능
```

### 2. 페이드 효과

```python
# 노란색 → 점점 흐려지며 → 하얀색
for alpha in range(255, 0, -25):
    color = QColor(255, 255, 0, alpha)
    # ...
```

### 3. 다른 색상 옵션

```python
# 사용자가 프리뷰 색상 선택
highlight_color = settings.get('highlight_color', 'yellow')
```

## 결론

하이라이트 색상과 타이밍 개선:
- ✅ 프리뷰: 빨간색 → 노란색
- ✅ 병합 후: 0.5초만 노란색 → 하얀색
- ✅ 색상 통일로 일관성 향상
- ✅ 일시적 하이라이트로 명확성 증가

**사용자가 클러스터링 진행 과정을 더 명확하게 이해할 수 있습니다!**
