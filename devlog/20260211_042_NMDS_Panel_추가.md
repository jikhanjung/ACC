# 042: NMDS Panel 추가

**작업 일시**: 2026-02-11

## 요약
기존 4-panel 레이아웃 오른쪽에 NMDS(Non-metric Multidimensional Scaling) 결과를 보여주는 5번째 패널을 추가. LeftPanel에 로드된 Local/Global 유사도 행렬을 선택하여 NMDS 산점도를 생성.

## 변경 내용

### 1. requirements.txt

```
# Before
numpy>=2.0.0
scipy>=1.11.0
pandas>=2.0.0

# After
numpy>=2.0.0
scipy>=1.11.0
pandas>=2.0.0
scikit-learn>=1.6.0
```

### 2. acc_gui.py - NMDSVisualizationWidget (line 3768)

Matplotlib FigureCanvas 기반 2D 산점도 위젯.

- `run_nmds(similarity_dict)`: similarity → distance 변환 후 MDS 실행, 산점도 렌더링
  - `acc_utils.similarity_to_distance()` 활용
  - `sklearn.manifold.MDS(metric_mds=False, metric="precomputed")` — 비계량 MDS
  - 각 점에 area 이름 라벨, 타이틀에 Stress 값 표시
- `save_image()`: 우클릭 컨텍스트 메뉴로 PNG/PDF/SVG 저장 (ACCVisualizationWidget 패턴 재사용)
- `clear_display()`: figure 초기화

### 3. acc_gui.py - NMDSPanel (line 3867)

ColumnPanel 상속, NMDS 실행 컨트롤 패널.

- Local/Global 선택 `QComboBox`
- "Run NMDS" `QPushButton` (주황색 스타일)
- `NMDSVisualizationWidget` 포함
- `on_run_clicked()` → `MainWindow.run_nmds()` 호출

### 4. acc_gui.py - MainWindow 수정

**init_ui() 변경:**
- `self.nmds_panel = NMDSPanel()` 생성
- `nmds_scroll` QScrollArea로 감싸서 splitter에 5번째로 추가
- 창 크기 2100→2400, splitter sizes `[400, 450, 450, 500, 500]`

**run_nmds() 메서드 추가:**
```python
def run_nmds(self):
    matrix_type = self.nmds_panel.matrix_combo.currentText()
    if matrix_type == "Local":
        df = self.left_panel.local_matrix_widget.get_dataframe()
    else:
        df = self.left_panel.global_matrix_widget.get_dataframe()
    similarity_dict = dict_matrix_from_dataframe(df)
    self.nmds_panel.nmds_widget.run_nmds(similarity_dict)
```

### 5. CHANGELOG.md

[Unreleased] 섹션에 NMDS 패널 추가 기록.

## 재사용 코드

| 항목 | 출처 |
|------|------|
| `similarity_to_distance()` | acc_utils.py:13 |
| `dict_matrix_from_dataframe()` | acc_utils.py:245 |
| `ColumnPanel` 상속 | acc_gui.py:3555 |
| 우클릭 이미지 저장 패턴 | ACCVisualizationWidget.save_image() |

## 기술 노트

- scikit-learn 1.6+에서 `MDS` API 변경에 대응:
  - `dissimilarity` → `metric="precomputed"`
  - `metric=False` → `metric_mds=False`
  - `init="random"` 명시 (1.10부터 기본값이 `classical_mds`로 변경 예정)
- `normalized_stress="auto"` 사용으로 stress 자동 정규화
- `random_state=42` 고정으로 재현 가능한 결과 보장
