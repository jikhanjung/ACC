# 20251112 P20: ACC ë‹¨ê³„ë³„ ì‹œê°í™”

## ê°œìš”

ACC ìƒì„± ê³¼ì •ì„ ë‹¨ê³„ë³„ë¡œ ì‹œê°í™”í•˜ì—¬ ì•Œê³ ë¦¬ì¦˜ ë™ì‘ì„ ì´í•´í•˜ê³  ë¬¸ì œë¥¼ ë””ë²„ê¹…í•˜ê¸° ì‰½ê²Œ ë§Œë“¤ê¸°.

## ìš”êµ¬ì‚¬í•­

### 1. ë‹¨ê³„ë³„ ì§„í–‰
- í˜„ì¬: Generate ACC ë²„íŠ¼ í´ë¦­ â†’ ìµœì¢… ê²°ê³¼ë§Œ í‘œì‹œ
- ê°œì„ : ê° ë³‘í•© ë‹¨ê³„ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ë³´ì—¬ì£¼ê¸°
- ë´ë“œë¡œê·¸ë¨ì²˜ëŸ¼ ìŠ¬ë¼ì´ë”ë¡œ ë‹¨ê³„ ì´ë™

### 2. ê° ë‹¨ê³„ ì •ë³´ í‘œì‹œ
- ì–´ë–¤ í´ëŸ¬ìŠ¤í„°ê°€ ë³‘í•©ë˜ëŠ”ì§€
- ë³‘í•© ë°©ì‹ (add_area vs merge_clusters)
- í˜„ì¬ê¹Œì§€ì˜ ë°°ì¹˜ ìƒíƒœ
- ê° ë©¤ë²„ì˜ ì¢Œí‘œ

### 3. ì‹œê°ì  í”¼ë“œë°±
- ì´ë²ˆ ë‹¨ê³„ì—ì„œ ì¶”ê°€ëœ ë©¤ë²„ í•˜ì´ë¼ì´íŠ¸
- ë³‘í•© ì „/í›„ ë¹„êµ
- ì• ë‹ˆë©”ì´ì…˜ (ì„ íƒì )

## í˜„ì¬ ì•Œê³ ë¦¬ì¦˜ êµ¬ì¡°

### build_acc_merged() í•¨ìˆ˜ (acc_core.py:342-370)

```python
def build_acc_merged(sub_dendro, inc_dendro, inc_matrix, unit=1.0):
    # 1) í´ëŸ¬ìŠ¤í„° ì¶”ì¶œ
    clusters = extract_clusters_from_dendro(sub_dendro)

    # 2) sim_inc, diameter, theta ê³„ì‚°
    decorate_clusters(clusters, inc_dendro, inc_matrix, unit)

    # 3) sim_sub ë†’ì€ ìˆœ ì •ë ¬
    clusters.sort(key=lambda c: c["sim_sub"], reverse=True)

    # 4) ì²« í´ëŸ¬ìŠ¤í„° ë°°ì¹˜
    base = place_first_cluster(clusters[0])

    # 5) ë‚˜ë¨¸ì§€ ìˆœì°¨ì  ë³‘í•© <- ì—¬ê¸°ë¥¼ ë‹¨ê³„ë³„ë¡œ!
    for c in clusters[1:]:
        if len(c["members"]) == len(base["members"]) + 1:
            base = add_area_to_cluster(base, c, inc_matrix)
        else:
            base = merge_two_clusters(base, c, inc_matrix)

    return base
```

### ë‹¨ê³„ êµ¬ë¶„

**Step 0**: ì´ˆê¸° ìƒíƒœ
- ê°€ì¥ ë†’ì€ sim_subë¥¼ ê°€ì§„ í´ëŸ¬ìŠ¤í„° ë°°ì¹˜
- ì˜ˆ: {J, T} í´ëŸ¬ìŠ¤í„° (sim_sub=0.9)

**Step 1~N**: ìˆœì°¨ì  ë³‘í•©
- ê° í´ëŸ¬ìŠ¤í„°ë¥¼ í•˜ë‚˜ì”© ì¶”ê°€
- ë³‘í•© ë°©ì‹ ê²°ì •:
  - add_area: ë©¤ë²„ 1ê°œ ì¶”ê°€ (ì˜ˆ: {J,T} â†’ {J,T,Y})
  - merge_clusters: ë…ë¦½ í´ëŸ¬ìŠ¤í„° ë³‘í•© (ì˜ˆ: {J,T,Y} + {N,O,Q})

## ì„¤ê³„

### 1. ë‹¨ê³„ë³„ ê²°ê³¼ ì €ì¥ í•¨ìˆ˜

**ìƒˆ í•¨ìˆ˜**: `build_acc_steps()`

```python
def build_acc_steps(sub_dendro, inc_dendro, inc_matrix, unit=1.0):
    """
    Build ACC step by step and return all intermediate states

    Returns:
        list of dicts, each containing:
        {
            "step": int,
            "action": "initial" | "add_area" | "merge_clusters",
            "current_cluster": dict,  # deep copy of base
            "new_cluster": dict | None,  # the cluster being added
            "description": str,
            "highlighted_members": set,  # newly added members
        }
    """
```

### 2. GUI êµ¬ì¡° ë³€ê²½

**ACCVisualizationWidget ìˆ˜ì •**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ğŸ¯ Generate ACC]                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Step: 0/5    [Step 0: Initial cluster]    â”‚
â”‚  â—€ [========|====] â–¶                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚         [ACC Visualization Canvas]          â”‚
â”‚                                             â”‚
â”‚                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Action: merge_clusters                     â”‚
â”‚  Added members: {N, O, Q}                   â”‚
â”‚  Current members: {J, T, Y, N, O, Q}        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. ë‹¨ê³„ë³„ ì‹œê°í™”

**ìƒ‰ìƒ êµ¬ë¶„**:
- ê¸°ì¡´ ë©¤ë²„: íŒŒë€ìƒ‰
- ìƒˆë¡œ ì¶”ê°€ëœ ë©¤ë²„: ë¹¨ê°„ìƒ‰ (í•˜ì´ë¼ì´íŠ¸)
- ì›: í˜„ì¬ diameter ê¸°ì¤€

**ì •ë³´ í‘œì‹œ**:
- Step ë²ˆí˜¸ / ì „ì²´ ë‹¨ê³„ ìˆ˜
- í˜„ì¬ action (initial/add_area/merge_clusters)
- ì¶”ê°€ëœ ë©¤ë²„
- ì „ì²´ ë©¤ë²„
- Diameter, Theta ê°’

### 4. ë°ì´í„° íë¦„

```
1. Generate ACC ë²„íŠ¼ í´ë¦­
   â†“
2. build_acc_steps() í˜¸ì¶œ
   â†’ ëª¨ë“  ë‹¨ê³„ ì €ì¥ (steps ë¦¬ìŠ¤íŠ¸)
   â†“
3. ACCVisualizationWidgetì— steps ì „ë‹¬
   â†“
4. ìŠ¬ë¼ì´ë”ë¡œ step ì„ íƒ
   â†“
5. í•´ë‹¹ stepì˜ ì‹œê°í™” í‘œì‹œ
```

## êµ¬í˜„ ê³„íš

### Phase 1: acc_core.py ìˆ˜ì •

1. **deep_copy_cluster() í•¨ìˆ˜ ì¶”ê°€**
   ```python
   def deep_copy_cluster(c):
       """Create a deep copy of cluster dict"""
       return {
           "members": set(c["members"]),
           "sim_sub": c["sim_sub"],
           "sim_inc": c["sim_inc"],
           "diameter": c["diameter"],
           "theta": c["theta"],
           "center": c["center"],
           "points": dict(c["points"]),
           "midline_angle": c["midline_angle"]
       }
   ```

2. **build_acc_steps() í•¨ìˆ˜ ì¶”ê°€**
   - build_acc_merged()ì™€ ìœ ì‚¬í•˜ì§€ë§Œ ê° ë‹¨ê³„ ì €ì¥
   - ì´ˆê¸° ìƒíƒœ (step 0) ì €ì¥
   - ê° ë³‘í•©ë§ˆë‹¤ ìŠ¤ëƒ…ìƒ· ì €ì¥
   - ìƒˆë¡œ ì¶”ê°€ëœ ë©¤ë²„ ì¶”ì 

### Phase 2: acc_utils.py ìˆ˜ì •

1. **build_acc_from_matrices_steps() í•¨ìˆ˜ ì¶”ê°€**
   - ê¸°ì¡´ build_acc_from_matrices()ì™€ ìœ ì‚¬
   - build_acc_steps() í˜¸ì¶œ
   - ë‹¨ê³„ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜

### Phase 3: GUI ìˆ˜ì • (acc_gui.py)

1. **ACCVisualizationWidget í´ë˜ìŠ¤ ìˆ˜ì •**:
   - `self.acc_steps`: ëª¨ë“  ë‹¨ê³„ ì €ì¥
   - `self.current_step`: í˜„ì¬ ë³´ê³  ìˆëŠ” ë‹¨ê³„
   - Step controls ì¶”ê°€ (ìŠ¬ë¼ì´ë”, ë²„íŠ¼, ë ˆì´ë¸”)

2. **UI ë ˆì´ì•„ì›ƒ ìˆ˜ì •**:
   ```python
   # Step controls
   self.step_controls = QWidget()
   self.step_slider = QSlider(Qt.Orientation.Horizontal)
   self.step_label = QLabel("Step: 0/0")
   self.step_desc_label = QLabel("No data")
   self.prev_btn = QPushButton("â—€")
   self.next_btn = QPushButton("â–¶")
   ```

3. **plot_acc_step() ë©”ì„œë“œ ì¶”ê°€**:
   - íŠ¹ì • ë‹¨ê³„ì˜ ì‹œê°í™”
   - í•˜ì´ë¼ì´íŠ¸ ì²˜ë¦¬
   - ì •ë³´ í‘œì‹œ

4. **MainWindow.generate_acc() ìˆ˜ì •**:
   - build_acc_from_matrices_steps() í˜¸ì¶œ
   - ACCVisualizationWidgetì— steps ì „ë‹¬

### Phase 4: í…ŒìŠ¤íŠ¸

1. **ë‹¨ê³„ë³„ ì§„í–‰ í…ŒìŠ¤íŠ¸**:
   - ìƒ˜í”Œ ë°ì´í„°ë¡œ ëª¨ë“  ë‹¨ê³„ í™•ì¸
   - ê° ë‹¨ê³„ì˜ ë©¤ë²„ ì¶”ê°€ í™•ì¸
   - ì¢Œí‘œ ê³„ì‚° ì •í™•ì„± í™•ì¸

2. **GUI í…ŒìŠ¤íŠ¸**:
   - ìŠ¬ë¼ì´ë” ë™ì‘ í™•ì¸
   - í•˜ì´ë¼ì´íŠ¸ í‘œì‹œ í™•ì¸
   - ì •ë³´ ë ˆì´ë¸” ì—…ë°ì´íŠ¸ í™•ì¸

## ì˜ˆìƒ ê²°ê³¼

### ìƒ˜í”Œ ë°ì´í„° (J, T, Y, N, O, Q)ì˜ ë‹¨ê³„ë³„ ì§„í–‰

**Step 0**: Initial
- Members: {J, T}
- Action: initial
- Description: "Initial cluster with highest similarity"

**Step 1**: Add area
- Members: {J, T, Y}
- Action: add_area
- Highlighted: {Y}
- Description: "Adding Y to cluster {J, T}"

**Step 2**: Merge clusters
- Members: {J, T, Y, N, O, Q}
- Action: merge_clusters
- Highlighted: {N, O, Q}
- Description: "Merging cluster {N, O, Q} with {J, T, Y}"

### ì‹œê°í™”

```
Step 0:          Step 1:          Step 2:
  T                 Y               N
 / \               /|\             /|\
J   center    T  center  O    T  center  O
                 /              /|\      |
                J              J Y Q    Q

íŒŒë€ìƒ‰: J, T     ë¹¨ê°„ìƒ‰: Y       ë¹¨ê°„ìƒ‰: N, O, Q
```

## ì¥ì 

1. **ë””ë²„ê¹… ìš©ì´**: ì–´ëŠ ë‹¨ê³„ì—ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ì§€ ëª…í™•íˆ í™•ì¸
2. **ì•Œê³ ë¦¬ì¦˜ ì´í•´**: ë³‘í•© ê³¼ì •ì„ ì‹œê°ì ìœ¼ë¡œ ì´í•´
3. **êµìœ¡ ëª©ì **: ACC ì•Œê³ ë¦¬ì¦˜ì˜ ë™ì‘ ë°©ì‹ ì„¤ëª…ì— ìœ ìš©
4. **ë¹„êµ ë¶„ì„**: ë´ë“œë¡œê·¸ë¨ topologyê°€ ë‹¤ë¥¼ ë•Œ ì–´ë–»ê²Œ ë‹¬ë¼ì§€ëŠ”ì§€ í™•ì¸

## ì¶”ê°€ ê¸°ëŠ¥ (ì„ íƒì‚¬í•­)

1. **ì• ë‹ˆë©”ì´ì…˜**:
   - ìë™ ì¬ìƒ ë²„íŠ¼
   - ë‹¨ê³„ ê°„ ë¶€ë“œëŸ¬ìš´ ì „í™˜

2. **ìƒì„¸ ì •ë³´ íŒ¨ë„**:
   - ê° ë©¤ë²„ì˜ ì¢Œí‘œ í…Œì´ë¸”
   - Diameter, Theta ê³„ì‚° ê³¼ì •

3. **ë¹„êµ ëª¨ë“œ**:
   - ë‘ ë‹¨ê³„ë¥¼ ë‚˜ë€íˆ í‘œì‹œ
   - ë³€ê²½ì‚¬í•­ í•˜ì´ë¼ì´íŠ¸

4. **Export**:
   - ê° ë‹¨ê³„ë¥¼ ì´ë¯¸ì§€ë¡œ ì €ì¥
   - ì• ë‹ˆë©”ì´ì…˜ GIF ìƒì„±

## ë‹¤ìŒ ë‹¨ê³„

ì´ ê¸°ëŠ¥ì´ ì™„ë£Œë˜ë©´:
1. í”„ë¦¬ë·°/ì• ë‹ˆë©”ì´ì…˜ ê¸°ëŠ¥ ì¶”ê°€
2. CSV ë‚´ë³´ë‚´ê¸° (ê° ë‹¨ê³„ì˜ ì¢Œí‘œ)
3. ì•Œê³ ë¦¬ì¦˜ íŒŒë¼ë¯¸í„° ì¡°ì • UI (unit ê°’ ë“±)
4. ë‹¤ì–‘í•œ ë³‘í•© ì „ëµ ë¹„êµ
