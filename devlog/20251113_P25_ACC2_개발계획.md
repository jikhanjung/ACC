# P25: ACC2 개발계획 (2025-11-13)

## 개요

ACC2는 dendrogram을 동심원 위에 projection하는 새로운 시각화 방식입니다. ACC1과 달리 모든 dendrogram merge level을 동심원으로 표현하고, 계층 구조를 직선과 호(arc)로 명시적으로 표시합니다.

## ACC1 vs ACC2 주요 차이점

### 1. 동심원 크기 계산 방식

**ACC1 (현재):**
```
diameter = unit / global_similarity
radius = diameter / 2
```
- 예: global_sim = 0.88 → diameter = 1.136, radius = 0.568
- 높은 similarity → 작은 원

**ACC2 (신규):**
```
diameter = 1 + (1 - global_similarity)
radius = diameter / 2
```
- 예: global_sim = 0.88 → diameter = 1.12, radius = 0.56
- 높은 similarity → 1에 가까운 원 (더 부드러운 증가)
- 낮은 similarity → 더 큰 원

### 2. Area 표시 위치

**ACC1 (현재):**
- 각 area가 처음 등장하는 merge level의 동심원에 배치
- J, T → r=0.568
- O, Q → r=0.602
- Y → r=0.617
- N → r=0.725

**ACC2 (신규):**
- **모든 area를 diameter=1 (radius=0.5)인 가장 안쪽 원에 배치**
- 각도는 ACC1의 최종 위치와 동일 (계층 구조는 유지)
- J, T, Y, N, O, Q 모두 → r=0.5

### 3. 계층 구조 시각화

**ACC1 (현재):**
- 점들의 위치로만 계층 구조 암시
- 연결선 없음

**ACC2 (신규):**
- **Dendrogram 스타일의 명시적 연결선**
- Radial lines: area에서 merge point로 (원과 수직)
- Arcs: 같은 radius에서 두 merge point 연결

## ACC2 연결선 구조

### Radial Line (방사선)
- **각 area의 각도를 유지한 채로** r=0.5에서 merge radius까지 수직으로 뻗어나감
- 원과 수직 방향 (normal to circle)
- 각 radial line은 자신의 각도를 유지
- 예: J가 angle=5°이면, J(r=0.5, angle=5°) → J_point(r=0.56, angle=5°)

### Arc (호)
- Merge radius 원 위에서 두 child의 radial line 끝점을 연결
- Arc의 중간 지점이 merge point
- Dendrogram의 수평선을 동심원 위의 arc로 매핑
- 예: J_point(r=0.56, angle=5°)와 T_point(r=0.56, angle=-5°)를 r=0.56 원 위의 arc로 연결

### 연결 예시

```
Level 1: J-T merge (global_sim=0.88)
  diameter = 1 + (1-0.88) = 1.12
  radius = 0.56

  Dendrogram 형태:          ACC2 동심원 매핑:
        ┌─┐                     r=0.56:
     ┌──┴──┐                J_point ─── arc ─── T_point
     │     │                    │                   │
     J     T                    │ radial            │ radial
                                │ (각도 5° 유지)    │ (각도 -5° 유지)
                                │                   │
                            J (r=0.5, 5°)      T (r=0.5, -5°)

  설명:
  - J: r=0.5 원에서 angle=5° 위치
  - J에서 radial line이 angle=5°를 유지하며 r=0.56까지 올라감
  - T: r=0.5 원에서 angle=-5° 위치
  - T에서 radial line이 angle=-5°를 유지하며 r=0.56까지 올라감
  - r=0.56 원에서 J_point와 T_point를 arc로 연결
  - Arc의 중간(angle=0°)이 J-T merge point
```

```
Level 3: [J,T]+Y merge (global_sim=0.81)
  diameter = 1 + (1-0.81) = 1.19
  radius = 0.595

  Dendrogram 형태:             ACC2 동심원 매핑:
         ┌──┐                      r=0.595:
      ┌──┴──┐                 JT_point ─── arc ─── Y_point
      │     │                     │                    │
    ┌─┐     Y                     │ radial             │ radial
   J  T                           │                    │
                                  │                    │
                           J-T merge (r=0.56)      Y (r=0.5)

  설명:
  - J-T merge point는 이미 r=0.56, angle=0°에 존재
  - J-T merge에서 radial line이 angle=0°를 유지하며 r=0.595까지 올라감
  - Y는 r=0.5, angle=18°에 위치 (예시)
  - Y에서 radial line이 angle=18°를 유지하며 r=0.595까지 올라감
  - r=0.595 원에서 JT_point와 Y_point를 arc로 연결
  - Arc의 중간이 [J,T,Y] merge point
```

## 알고리즘 설계

### Phase 1: Dendrogram 분석 및 동심원 생성

```python
def analyze_dendrogram_levels(local_matrix, global_matrix):
    """
    Dendrogram의 모든 merge level 추출

    Returns:
        levels: [
            {
                'level': 1,
                'cluster1': 'J',
                'cluster2': 'T',
                'members': ['J', 'T'],
                'local_sim': 0.9,
                'global_sim': 0.88,
                'diameter': 1.12,
                'radius': 0.56
            },
            ...
        ]
    """
    # Hierarchical clustering (average linkage) 수행
    # 각 merge 시점마다:
    #   - local similarity 계산
    #   - global similarity 계산
    #   - diameter = 1 + (1 - global_sim)
    #   - radius = diameter / 2
```

### Phase 2: Area 최종 각도 계산

```python
def calculate_final_positions(local_matrix, global_matrix):
    """
    ACC1 알고리즘을 실행하여 각 area의 최종 각도 얻기

    Returns:
        positions: {
            'J': (x, y, angle),  # angle은 cart2pol로 계산
            'T': (x, y, angle),
            ...
        }
    """
    # ACC1 알고리즘 실행
    # 각 area의 최종 위치에서 angle 추출
    # 이 angle을 r=0.5 원에 적용
```

### Phase 3: Merge Point 위치 계산

```python
def calculate_merge_points(levels, final_positions):
    """
    각 merge level의 merge point 위치 계산

    Returns:
        merge_points: {
            'J,T': {
                'radius': 0.56,
                'angle': 0.0,  # J와 T의 중간 각도
                'children': ['J', 'T']
            },
            ...
        }
    """
    # 각 merge level마다:
    #   - radius는 이미 계산됨
    #   - angle은 두 child의 중간값
    #     - child가 area면: final_positions에서 각도 가져오기
    #     - child가 cluster면: 해당 merge_point의 각도 가져오기
```

### Phase 4: 연결선 생성

```python
def generate_connection_lines(levels, final_positions, merge_points):
    """
    Radial lines과 arcs 생성

    Returns:
        lines: [
            {
                'type': 'radial',
                'from': (r1, angle),  # r1에서 시작
                'to': (r2, angle)     # r2까지, 같은 각도 유지
            },
            {
                'type': 'arc',
                'radius': r,
                'angle_start': a1,
                'angle_end': a2
            },
            ...
        ]
    """
    # 각 merge level마다:
    #   1. Child 1의 radial line:
    #      - child1이 area면: (r=0.5, child1_angle) → (merge_radius, child1_angle)
    #      - child1이 cluster면: (previous_merge_radius, child1_angle) → (merge_radius, child1_angle)
    #
    #   2. Child 2의 radial line:
    #      - child2가 area면: (r=0.5, child2_angle) → (merge_radius, child2_angle)
    #      - child2가 cluster면: (previous_merge_radius, child2_angle) → (merge_radius, child2_angle)
    #
    #   3. Arc:
    #      - radius: merge_radius
    #      - angle_start: min(child1_angle, child2_angle)
    #      - angle_end: max(child1_angle, child2_angle)
    #      - 이 arc의 중간 지점이 merge point
```

### Phase 5: 시각화

```python
def visualize_acc2(levels, final_positions, merge_points, lines):
    """
    ACC2 다이어그램 그리기
    """
    # 1. 모든 동심원 그리기 (각 level의 radius)
    #    - innermost: r=0.5 (area 배치용)
    #    - 각 merge level: r=0.56, 0.595, 0.725, 0.824, ...

    # 2. 모든 area를 r=0.5 원에 표시
    #    - final_positions의 각도 사용

    # 3. 연결선 그리기
    #    - Radial lines: 직선
    #    - Arcs: matplotlib.patches.Arc 사용

    # 4. Merge points 표시 (선택적)
    #    - 작은 점으로 표시
```

## 데이터 구조

### Level 정보
```python
{
    'level': int,                    # Merge 순서
    'cluster1': str or list,         # 첫 번째 child
    'cluster2': str or list,         # 두 번째 child
    'members': set,                  # 모든 멤버
    'structure': list,               # 중첩 구조
    'local_sim': float,                # Local similarity
    'global_sim': float,                # Global similarity
    'diameter': float,               # 1 + (1 - global_sim)
    'radius': float                  # diameter / 2
}
```

### Position 정보
```python
{
    'area_name': {
        'x': float,                  # Cartesian x
        'y': float,                  # Cartesian y
        'radius': float,             # ACC2에서는 항상 0.5
        'angle': float               # 각도 (degrees)
    }
}
```

### Merge Point 정보
```python
{
    'cluster_id': {
        'radius': float,             # Merge level의 radius
        'angle': float,              # Children의 중간 각도
        'children': list,            # Child area/cluster IDs
        'level': int                 # Merge level
    }
}
```

### Connection Line 정보
```python
# Radial line
{
    'type': 'radial',
    'from': (radius, angle),
    'to': (radius, angle)
}

# Arc
{
    'type': 'arc',
    'radius': float,
    'angle_start': float,
    'angle_end': float
}
```

## 예상 결과 (J,T,Y,N,O,Q 데이터)

### 동심원 (6개)
1. r=0.500: Area 표시용 (innermost)
2. r=0.560: J-T merge (global_sim=0.88)
3. r=0.602: O-Q merge (global_sim=0.83)
4. r=0.595: [J,T]+Y merge (global_sim=0.81)
5. r=0.655: [O,Q]+N merge (global_sim=0.69)
6. r=0.824: Final merge (global_sim=0.353)

### Area 위치 (모두 r=0.5)
- J: (r=0.5, angle=ACC1_final_angle)
- T: (r=0.5, angle=ACC1_final_angle)
- Y: (r=0.5, angle=ACC1_final_angle)
- O: (r=0.5, angle=ACC1_final_angle)
- Q: (r=0.5, angle=ACC1_final_angle)
- N: (r=0.5, angle=ACC1_final_angle)

### 연결선
- J → (r=0.56, J-T merge point)
- T → (r=0.56, J-T merge point)
- Arc at r=0.56: J merge point ↔ T merge point
- ... (각 level마다 반복)

## 구현 순서

### Step 1: 알고리즘 구현
- `acc_core_acc2.py` 생성
- Dendrogram 분석 함수
- Merge point 계산 함수
- 연결선 생성 함수

### Step 2: 시각화 구현
- `visualize_acc2.py` 생성
- 동심원 그리기
- Area 표시 (r=0.5)
- Radial lines 그리기
- Arcs 그리기

### Step 3: GUI 통합
- `acc_gui.py`의 `generate_acc2()` 구현
- ACC2 전용 위젯 생성 (필요시)
- 단계별 시각화 (선택적)

### Step 4: 테스트
- Sample data로 검증
- ACC1과 각도 일치 확인
- Dendrogram과 구조 일치 확인

## 향후 확장 가능성

1. **Interactive visualization**
   - Merge point에 마우스 hover 시 정보 표시
   - 특정 level 하이라이트

2. **Export options**
   - SVG로 저장 (publication quality)
   - PDF 저장

3. **Comparison view**
   - ACC1과 ACC2를 나란히 표시
   - 차이점 시각적으로 비교

## 참고사항

- ACC1의 알고리즘 로직은 그대로 사용 (각도 계산)
- 동심원 크기만 새로운 공식 적용
- Dendrogram 구조는 hierarchical clustering 결과 사용

## 예상 시간

- Phase 1-3 (알고리즘): 2-3시간
- Phase 4-5 (시각화): 2-3시간
- GUI 통합: 1시간
- 테스트 및 디버깅: 1-2시간

**Total: 6-9시간**
