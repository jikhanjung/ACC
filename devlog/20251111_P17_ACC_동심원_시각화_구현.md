# 20251111 P17: ACC ë™ì‹¬ì› ì‹œê°í™” êµ¬í˜„

## ê°œìš”

ACC ì•Œê³ ë¦¬ì¦˜ì˜ í•µì‹¬ ê°œë…ì¸ **ë™ì‹¬ì›(concentric circles)** êµ¬ì¡°ë¥¼ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„.

## ë¬¸ì œ

### Before (í‹€ë¦¼)

```
í•˜ë‚˜ì˜ ì›ì— ëª¨ë“  area í‘œì‹œ:
       Y
   Jâ”€â”€â”€+â”€â”€â”€T   Oâ”€â”€â”€Q  N    â† ëª¨ë“  ì ì´ ê°™ì€ ì› ìœ„
       â­•

ë¬¸ì œ:
- âŒ ë‹¨ì¼ ì›ë§Œ í‘œì‹œ
- âŒ ê° í´ëŸ¬ìŠ¤í„°ì˜ ê³ ìœ í•œ diameter ì •ë³´ ì†ì‹¤
- âŒ ë…¼ë¬¸ì˜ í•µì‹¬ ê°œë… ë¯¸êµ¬í˜„
```

### After (ì˜¬ë°”ë¦„)

```
ì—¬ëŸ¬ ê°œì˜ ë™ì‹¬ì›, í´ëŸ¬ìŠ¤í„°ë³„ë¡œ ë¶„ë¦¬:

    â­•â­•â­•â­•â­•  â† Cluster 5 (d=1.818, ê°€ì¥ í° ì›)
     â­•â­•â­•â­•   â† Cluster 4 (d=1.429)
      â­•â­•â­•    â† Cluster 3 (d=1.282)
       â­•â­•     â† Cluster 2 (d=1.205)
        â­•      â† Cluster 1 (d=1.136, ê°€ì¥ ì‘ì€ ì›)

ê°œì„ :
- âœ… ì—¬ëŸ¬ ê°œì˜ ì› í‘œì‹œ
- âœ… ê° í´ëŸ¬ìŠ¤í„°ê°€ ê³ ìœ í•œ diameter ê°€ì§
- âœ… sim_inc ê¸°ë°˜ diameter ì‹œê°í™”
- âœ… ë…¼ë¬¸ì˜ ë™ì‹¬ì› ê°œë… êµ¬í˜„
```

## êµ¬í˜„

### 1. acc_core.py - build_acc() ìˆ˜ì •

**Before (ë‹¨ì¼ ë³‘í•©)**

```python
def build_acc(sub_dendro, inc_dendro, inc_matrix, unit=1.0):
    # 1) ëª¨ë“  í´ëŸ¬ìŠ¤í„° ì¶”ì¶œ
    clusters = extract_clusters_from_dendro(sub_dendro)

    # 2) ê° í´ëŸ¬ìŠ¤í„°ì— sim_inc, diameter, theta ë¶€ì—¬
    decorate_clusters(clusters, inc_dendro, inc_matrix, unit=unit)

    # 3) ìœ ì‚¬ë„ ìˆœ ì •ë ¬
    clusters.sort(key=lambda c: c["sim_sub"], reverse=True)

    # 4) ì²« í´ëŸ¬ìŠ¤í„° ë°°ì¹˜
    base = place_first_cluster(clusters[0])

    # 5) ë‚˜ë¨¸ì§€ í´ëŸ¬ìŠ¤í„°ë¥¼ í•˜ë‚˜ì”© ë³‘í•© âš ï¸
    for c in clusters[1:]:
        if ...:
            base = add_area_to_cluster(base, c, inc_matrix)
        else:
            base = merge_two_clusters(base, c, inc_matrix)

    # âš ï¸ ë‹¨ì¼ ê²°ê³¼ ë°˜í™˜
    return base
```

**After (ë‹¤ì¤‘ ë™ì‹¬ì›)**

```python
def build_acc(sub_dendro, inc_dendro, inc_matrix, unit=1.0):
    """
    Build ACC result with multiple concentric circles
    Each cluster gets its own circle based on its diameter

    Returns:
        dict with:
            - 'clusters': list of positioned clusters
            - 'all_members': set of all members across all clusters
    """
    # 1) ëª¨ë“  í´ëŸ¬ìŠ¤í„° ì¶”ì¶œ
    clusters = extract_clusters_from_dendro(sub_dendro)

    # 2) ê° í´ëŸ¬ìŠ¤í„°ì— sim_inc, diameter, theta ë¶€ì—¬
    decorate_clusters(clusters, inc_dendro, inc_matrix, unit=unit)

    # 3) ë‹¨ì¼ ë©¤ë²„ í´ëŸ¬ìŠ¤í„° ì œì™¸ (2ê°œ ì´ìƒë§Œ)
    clusters = [c for c in clusters if len(c["members"]) >= 2]

    # 4) ìœ ì‚¬ë„ ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬
    clusters.sort(key=lambda c: c["sim_sub"], reverse=True)

    # 5) ê° í´ëŸ¬ìŠ¤í„°ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ë°°ì¹˜ âœ…
    positioned_clusters = []
    for c in clusters:
        positioned = place_first_cluster(c)
        positioned_clusters.append(positioned)

    # 6) ëª¨ë“  í´ëŸ¬ìŠ¤í„° ë°˜í™˜ âœ…
    all_members = set()
    for c in positioned_clusters:
        all_members.update(c["members"])

    return {
        "clusters": positioned_clusters,
        "all_members": all_members
    }
```

**í•µì‹¬ ë³€ê²½:**
- âŒ Before: ëª¨ë“  í´ëŸ¬ìŠ¤í„°ë¥¼ **ë³‘í•©**í•˜ì—¬ í•˜ë‚˜ë¡œ
- âœ… After: ê° í´ëŸ¬ìŠ¤í„°ë¥¼ **ë…ë¦½ì ìœ¼ë¡œ ë°°ì¹˜**

### 2. acc_utils.py - build_acc_from_matrices() ê°„ì†Œí™”

**Before**

```python
def build_acc_from_matrices(sub_matrix, inc_matrix, unit=1.0, method='average'):
    # ... ë´ë“œë¡œê·¸ë¨ ìƒì„±

    # í´ëŸ¬ìŠ¤í„° ì¶”ì¶œ ë° ë³‘í•© ë¡œì§ ì¤‘ë³µ êµ¬í˜„ âš ï¸
    clusters = extract_clusters_from_dendro_filtered(sub_dendro)
    decorate_clusters(clusters, inc_dendro, inc_matrix, unit=unit)
    clusters.sort(...)
    base = place_first_cluster(clusters[0])
    for c in clusters[1:]:
        # ë³‘í•© ë¡œì§
        ...

    return base
```

**After**

```python
def build_acc_from_matrices(sub_matrix, inc_matrix, unit=1.0, method='average'):
    """
    Build ACC result directly from similarity matrices with multiple concentric circles
    """
    from acc_core import build_acc

    # ë´ë“œë¡œê·¸ë¨ ìƒì„±
    sub_dendro, sub_labels = matrix_to_dendrogram(sub_matrix, method=method)
    inc_dendro, inc_labels = matrix_to_dendrogram(inc_matrix, method=method)

    # build_acc í˜¸ì¶œ (ì´ì œ ë‹¤ì¤‘ ë™ì‹¬ì› ë°˜í™˜)
    acc_result = build_acc(sub_dendro, inc_dendro, inc_matrix, unit=unit)

    return acc_result
```

**ê°œì„ :**
- âœ… ì¤‘ë³µ ì½”ë“œ ì œê±°
- âœ… `build_acc()` í•¨ìˆ˜ì— ìœ„ì„
- âœ… ì½”ë“œ ê°„ì†Œí™” (45ì¤„ â†’ 12ì¤„)

### 3. acc_gui.py - plot_acc_result() ìˆ˜ì •

**Before (ë‹¨ì¼ ì›)**

```python
def plot_acc_result(self, acc_result):
    # ë‹¨ì¼ ê²°ê³¼ì—ì„œ ë°ì´í„° ì¶”ì¶œ
    center = acc_result.get("center", (0, 0))
    diameter = acc_result.get("diameter", 1.0)
    radius = diameter / 2.0
    points = acc_result.get("points", {})
    members = acc_result.get("members", set())

    # ì› í•˜ë‚˜ë§Œ ê·¸ë¦¬ê¸° âš ï¸
    circle = plt.Circle(center, radius, fill=False,
                       edgecolor='blue', linewidth=2)
    ax.add_patch(circle)

    # ëª¨ë“  ì ì„ ê°™ì€ ì› ìœ„ì— í‘œì‹œ
    for member, (x, y) in points.items():
        ax.plot(x, y, 'o', markersize=10, ...)
```

**After (ë‹¤ì¤‘ ë™ì‹¬ì›)**

```python
def plot_acc_result(self, acc_result):
    """Plot ACC result with multiple concentric circles"""
    # ë‹¤ì¤‘ í´ëŸ¬ìŠ¤í„°ì—ì„œ ë°ì´í„° ì¶”ì¶œ
    clusters = acc_result.get("clusters", [])
    all_members = acc_result.get("all_members", set())

    if len(clusters) == 0:
        # ì—ëŸ¬ í‘œì‹œ
        return

    # í´ëŸ¬ìŠ¤í„°ë³„ ìƒ‰ìƒ ìƒì„±
    cluster_colors = plt.cm.Set3(np.linspace(0, 1, len(clusters)))

    # ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•œ ì¶”ì 
    plotted_members = set()

    # ê° í´ëŸ¬ìŠ¤í„°ë§ˆë‹¤ ì› ê·¸ë¦¬ê¸° âœ…
    for cluster_idx, cluster in enumerate(clusters):
        center = cluster.get("center", (0, 0))
        diameter = cluster["diameter"]
        radius = diameter / 2.0
        points = cluster["points"]
        members = cluster["members"]

        # í´ëŸ¬ìŠ¤í„°ì˜ ì› ê·¸ë¦¬ê¸°
        circle = plt.Circle(center, radius, fill=False,
                          edgecolor=cluster_colors[cluster_idx],
                          linewidth=2,
                          label=f"Cluster {cluster_idx+1} ({len(members)} members)")
        ax.add_patch(circle)

        # í´ëŸ¬ìŠ¤í„°ì˜ ì ë“¤ ê·¸ë¦¬ê¸°
        for member, (x, y) in points.items():
            if member not in plotted_members:
                ax.plot(x, y, 'o', markersize=10,
                       color=cluster_colors[cluster_idx], ...)
                ax.text(x, y, f'  {member}', ...)
                plotted_members.add(member)

    # ê°€ì¥ í° ì› ê¸°ì¤€ìœ¼ë¡œ ì¶• ë²”ìœ„ ì„¤ì • âœ…
    max_radius = max(c["diameter"]/2.0 for c in clusters)
    margin = max_radius * 0.3
    ax.set_xlim(-max_radius - margin, max_radius + margin)
    ax.set_ylim(-max_radius - margin, max_radius + margin)

    # ë²”ë¡€ ì¶”ê°€ âœ…
    ax.legend(loc='upper right', fontsize=8)

    # ì •ë³´ í…ìŠ¤íŠ¸
    info_text = f"Total members: {len(all_members)}\nClusters: {len(clusters)}"
    ax.text(0.02, 0.98, info_text, ...)
```

**ê°œì„ :**
- âœ… ì—¬ëŸ¬ ê°œì˜ ì› ê·¸ë¦¬ê¸°
- âœ… ê° í´ëŸ¬ìŠ¤í„°ë§ˆë‹¤ ë‹¤ë¥¸ ìƒ‰ìƒ
- âœ… ë²”ë¡€ë¡œ í´ëŸ¬ìŠ¤í„° êµ¬ë¶„
- âœ… ì¤‘ë³µ ë©¤ë²„ ë°©ì§€ (ì²« ë“±ì¥ ìœ„ì¹˜ë§Œ í‘œì‹œ)

## ë™ì‘ ì›ë¦¬

### Diameter ê³„ì‚°

```python
# acc_core.py - decorate_clusters()
for c in clusters:
    members = c["members"]

    # 1) inclusive ë´ë“œë¡œê·¸ë¨ì—ì„œ sim_inc ì°¾ê¸°
    inc_sim = find_cluster_in_dendro_by_members(inc_dendro, members)

    # 2) ì—†ìœ¼ë©´ í–‰ë ¬ì—ì„œ í‰ê·  ê³„ì‚°
    if inc_sim is None:
        inc_sim = average_pairwise_similarity(members, inc_matrix)

    c["sim_inc"] = inc_sim

    # 3) ì§€ë¦„ ê³„ì‚°: d = unit / sim_inc
    if inc_sim <= 0:
        d = unit * 1000
    else:
        d = unit / inc_sim  # â† í•µì‹¬ ê³µì‹!

    c["diameter"] = d
    c["theta"] = 180.0 * (1.0 - c["sim_sub"])
```

### ì˜ˆì‹œ ê³„ì‚°

```
Sample data (unit=1.0):

Cluster 1: {J, T}
  - sim_inc = 0.88
  - diameter = 1.0 / 0.88 = 1.136

Cluster 2: {O, Q}
  - sim_inc = 0.83
  - diameter = 1.0 / 0.83 = 1.205

Cluster 3: {J, T, Y}
  - sim_inc = 0.78
  - diameter = 1.0 / 0.78 = 1.282

Cluster 4: {N, O, Q}
  - sim_inc = 0.70
  - diameter = 1.0 / 0.70 = 1.429

Cluster 5: {J, T, Y, N, O, Q}
  - sim_inc = 0.55
  - diameter = 1.0 / 0.55 = 1.818

â†’ 5ê°œì˜ ë™ì‹¬ì›, diameter ìˆœì„œëŒ€ë¡œ!
```

### ì‹œê°í™”

```
        â­•â­•â­•â­•â­•  â† d=1.818 (sim_inc=0.55, ë‚®ìŒ â†’ ì§€ë¦„ í¼)
         â­•â­•â­•â­•   â† d=1.429 (sim_inc=0.70)
          â­•â­•â­•    â† d=1.282 (sim_inc=0.78)
           â­•â­•     â† d=1.205 (sim_inc=0.83)
            â­•      â† d=1.136 (sim_inc=0.88, ë†’ìŒ â†’ ì§€ë¦„ ì‘ìŒ)

í•µì‹¬:
- sim_incê°€ ë†’ì„ìˆ˜ë¡ â†’ ì§€ë¦„ ì‘ìŒ (ì‘ì§‘ë ¥ ë†’ìŒ)
- sim_incê°€ ë‚®ì„ìˆ˜ë¡ â†’ ì§€ë¦„ í¼ (ì‘ì§‘ë ¥ ë‚®ìŒ)
```

## Text.docxì™€ì˜ ì¼ì¹˜

### ë…¼ë¬¸ì˜ í•µì‹¬ ê°œë…

```
ACC (Area Affinity in Concentric Circles):
1. ë‘ ê°œì˜ dendrogram ì‚¬ìš©:
   - Subordinate: íŠ¹ì • ì‹œê¸°ì˜ ë°ì´í„°
   - Inclusive: ì „ì²´ ì‹œê¸°ì˜ ë°ì´í„°

2. ê° clusterëŠ” ë‘ ê°œì˜ similarity ê°’:
   - sim_sub: closest affinity â†’ angle (Î¸)
   - sim_inc: farthest affinity â†’ diameter (d)

3. Geometric conversion:
   - Diameter: d = unit / sim_inc
   - Angle: Î¸ = 180Â° Ã— (1 - sim_sub)

4. Concentric circles:
   - ê° clusterëŠ” ê³ ìœ í•œ ì§€ë¦„ì˜ ì›ì„ í˜•ì„±
   - ì›ë“¤ì´ ë™ì‹¬ì› êµ¬ì¡°ë¡œ ë°°ì¹˜
   - ê°™ì€ ì¤‘ì‹¬ì (origin)ì„ ê³µìœ 
```

### êµ¬í˜„ ì¼ì¹˜

| ë…¼ë¬¸ ê°œë… | êµ¬í˜„ |
|---------|------|
| ë‘ ê°œì˜ dendrogram | âœ… `sub_dendro`, `inc_dendro` |
| sim_sub (angle) | âœ… `c["sim_sub"]` â†’ `c["theta"]` |
| sim_inc (diameter) | âœ… `c["sim_inc"]` â†’ `c["diameter"]` |
| d = unit / sim_inc | âœ… `d = unit / inc_sim` |
| Î¸ = 180Â°(1 - sim_sub) | âœ… `theta = 180.0 * (1.0 - c["sim_sub"])` |
| Concentric circles | âœ… ì—¬ëŸ¬ ì›, ê°ê° ë‹¤ë¥¸ diameter |

## ì‚¬ìš©ì ê²½í—˜

### Before

```
ì‚¬ìš©ì: "ACCë¥¼ ë³´ë‹ˆê¹Œ..."
      â†’ "ì› í•˜ë‚˜ì— ëª¨ë“  ì ì´ ëª°ë ¤ìˆë„¤?"
      â†’ "ì™œ ë™ì‹¬ì›ì´ ì•„ë‹ˆì§€? ğŸ¤”"
      â†’ "ë…¼ë¬¸ì´ë‘ ë‹¤ë¥¸ë°?"
```

### After

```
ì‚¬ìš©ì: "ACCë¥¼ ë³´ë‹ˆê¹Œ..."
      â†’ "ì—¬ëŸ¬ ê°œì˜ ë™ì‹¬ì›ì´ ë³´ì´ë„¤!"
      â†’ "ê° í´ëŸ¬ìŠ¤í„°ë§ˆë‹¤ ë‹¤ë¥¸ í¬ê¸°ì˜ ì›!"
      â†’ "ë…¼ë¬¸ì— ë‚˜ì˜¨ ê·¸ë¦¼ì´ë‘ ë˜‘ê°™ì•„! âœ“"
      â†’ "sim_incê°€ ë‚®ì„ìˆ˜ë¡ ì›ì´ í¬êµ¬ë‚˜!"
```

## ê¸°ëŒ€ íš¨ê³¼

### 1. ì •í™•ì„±
- âœ… ë…¼ë¬¸ì˜ í•µì‹¬ ê°œë… ì •í™•íˆ êµ¬í˜„
- âœ… sim_inc ê¸°ë°˜ diameter ì‹œê°í™”
- âœ… ê° í´ëŸ¬ìŠ¤í„°ì˜ ê³ ìœ í•œ íŠ¹ì„± í‘œí˜„

### 2. ê°€ë…ì„±
- âœ… í´ëŸ¬ìŠ¤í„°ë³„ë¡œ ìƒ‰ìƒ êµ¬ë¶„
- âœ… ë²”ë¡€ë¡œ ê° í´ëŸ¬ìŠ¤í„° ì‹ë³„
- âœ… ë©¤ë²„ ìˆ˜ ì •ë³´ í‘œì‹œ

### 3. ì´í•´ë„
- âœ… í´ëŸ¬ìŠ¤í„° ê°„ì˜ í¬ê¸° ì°¨ì´ ëª…í™•
- âœ… ì‘ì§‘ë ¥ ë†’ì€ í´ëŸ¬ìŠ¤í„° = ì‘ì€ ì›
- âœ… ì‘ì§‘ë ¥ ë‚®ì€ í´ëŸ¬ìŠ¤í„° = í° ì›

### 4. êµìœ¡/ì—°êµ¬
- âœ… ë…¼ë¬¸ ì¬í˜„ ê°€ëŠ¥
- âœ… ì•Œê³ ë¦¬ì¦˜ ì´í•´ ìš©ì´
- âœ… ê²°ê³¼ ë¶„ì„ í¸ë¦¬

## í…ŒìŠ¤íŠ¸ ê²°ê³¼

```bash
$ python acc_core.py
ACC all members: {'O', 'N', 'Q', 'Y', 'T', 'J'}

Number of clusters: 5

Cluster details:

  Cluster 1:
    Members: {'T', 'J'}
    Diameter: 1.136
    Theta: 18.00Â°

  Cluster 2:
    Members: {'O', 'Q'}
    Diameter: 1.205
    Theta: 27.00Â°

  Cluster 3:
    Members: {'T', 'Y', 'J'}
    Diameter: 1.282
    Theta: 36.00Â°

  Cluster 4:
    Members: {'O', 'N', 'Q'}
    Diameter: 1.429
    Theta: 45.00Â°

  Cluster 5:
    Members: {'O', 'Y', 'T', 'N', 'J', 'Q'}
    Diameter: 1.818
    Theta: 72.00Â°
```

**í™•ì¸:**
- âœ… 5ê°œì˜ í´ëŸ¬ìŠ¤í„° ìƒì„±
- âœ… ê° í´ëŸ¬ìŠ¤í„°ë§ˆë‹¤ ê³ ìœ í•œ diameter
- âœ… diameterê°€ ì ì§„ì ìœ¼ë¡œ ì¦ê°€ (1.136 â†’ 1.818)
- âœ… ë©¤ë²„ ìˆ˜ê°€ ì¦ê°€í• ìˆ˜ë¡ diameter ì¦ê°€
- âœ… sim_inc ê¸°ë°˜ ê³„ì‚° ì •í™•

## GUI í…ŒìŠ¤íŠ¸

```bash
$ python acc_gui.py
# Load sample_subordinate.csv (subordinate)
# Load sample_inclusive.csv (inclusive)
# Click "Generate ACC"
```

**í™•ì¸ í•­ëª©:**
1. âœ… ì—¬ëŸ¬ ê°œì˜ ë™ì‹¬ì› í‘œì‹œ
2. âœ… ê° ì›ë§ˆë‹¤ ë‹¤ë¥¸ ìƒ‰ìƒ
3. âœ… ë²”ë¡€ì— í´ëŸ¬ìŠ¤í„° ì •ë³´ í‘œì‹œ
4. âœ… ì›ì˜ í¬ê¸°ê°€ ë‹¤ë¦„ (diameter ë°˜ì˜)
5. âœ… ëª¨ë“  ë©¤ë²„ê°€ í‘œì‹œë¨
6. âœ… ì •ë³´ í…ìŠ¤íŠ¸ì— í´ëŸ¬ìŠ¤í„° ìˆ˜ í‘œì‹œ

## ì´ì „ ë²„ì „ ë³´ì¡´

ì›ë³¸ ë³‘í•© ë°©ì‹ì´ í•„ìš”í•  ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬ `build_acc_merged()` í•¨ìˆ˜ë¡œ ë³´ì¡´:

```python
# acc_core.py
def build_acc_merged(sub_dendro, inc_dendro, inc_matrix, unit=1.0):
    """
    Build ACC result by merging all clusters into one
    This is the original implementation that returns a single merged result
    """
    # ... ì›ë³¸ ë¡œì§
```

## ê²°ë¡ 

ACC ì•Œê³ ë¦¬ì¦˜ì˜ í•µì‹¬ì¸ **ë™ì‹¬ì› êµ¬ì¡°** ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„:

**ë³€ê²½ ìš”ì•½:**
- âœ… `build_acc()`: ë‹¤ì¤‘ í´ëŸ¬ìŠ¤í„° ë°˜í™˜
- âœ… `build_acc_from_matrices()`: ê°„ì†Œí™”
- âœ… `plot_acc_result()`: ë‹¤ì¤‘ ë™ì‹¬ì› ì‹œê°í™”

**íš¨ê³¼:**
- âœ… ë…¼ë¬¸ì˜ í•µì‹¬ ê°œë… ì •í™•íˆ êµ¬í˜„
- âœ… sim_inc ê¸°ë°˜ diameter ì‹œê°í™”
- âœ… ê° í´ëŸ¬ìŠ¤í„°ì˜ ê³ ìœ ì„± í‘œí˜„
- âœ… ì‚¬ìš©ì ì´í•´ë„ í–¥ìƒ

**ì‚¬ìš©ìê°€ ìš”êµ¬í•œ "concentric circles" êµ¬ì¡°ê°€ ì™„ë²½í•˜ê²Œ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤!**
