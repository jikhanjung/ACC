# 20251111 P07: ë³‘í•© ë¯¸ë¦¬ë³´ê¸° ì• ë‹ˆë©”ì´ì…˜

## ê°œìš”

Next ë²„íŠ¼ í´ë¦­ ì‹œ ë³‘í•©ë  í´ëŸ¬ìŠ¤í„°ë¥¼ ë¯¸ë¦¬ í•˜ì´ë¼ì´íŠ¸ë¡œ ë³´ì—¬ì£¼ëŠ” ì• ë‹ˆë©”ì´ì…˜ ê¸°ëŠ¥ ì¶”ê°€.

## ì‚¬ìš©ì ìš”ì²­

> "Next ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ë¨¼ì € í•©ì³ì§ˆ area ì˜ row/column ì„ highlight í•´ì„œ ì ì‹œ(0.5ì´ˆ?) ë³´ì—¬ì£¼ê³  í•©ì³ì£¼ë©´ ì¢‹ê² ì–´."

### ëª©í‘œ

1. Next ë²„íŠ¼ í´ë¦­ ì‹œ **ì¦‰ì‹œ ë³‘í•©í•˜ì§€ ì•ŠìŒ**
2. **ë¯¸ë¦¬ë³´ê¸° ë‹¨ê³„**: ë³‘í•©ë  í´ëŸ¬ìŠ¤í„°ë¥¼ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í•˜ì´ë¼ì´íŠ¸
3. **0.5ì´ˆ ëŒ€ê¸°** í›„ ì‹¤ì œ ë³‘í•© ìˆ˜í–‰
4. ì‚¬ìš©ìê°€ ì–´ë–¤ í´ëŸ¬ìŠ¤í„°ê°€ ë³‘í•©ë˜ëŠ”ì§€ ëª…í™•íˆ ì¸ì§€

## êµ¬í˜„

### 1. ìƒˆë¡œìš´ ìƒíƒœ ì¶”ê°€ (StepMatrixWidget)

```python
class StepMatrixWidget(QWidget):
    def __init__(self, title="Matrix", parent=None):
        # ...
        self.is_preview_mode = False  # ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ ì—¬ë¶€
        self.preview_clusters = None  # (idx_i, idx_j) ë¯¸ë¦¬ë³´ê¸° ëŒ€ìƒ
```

### 2. Next ë²„íŠ¼ ë™ì‘ ìˆ˜ì •

#### Before (ì¦‰ì‹œ ë³‘í•©)
```python
def next_step(self):
    if self.current_step < max_step:
        self.step_slider.setValue(self.current_step + 1)
```

#### After (ë¯¸ë¦¬ë³´ê¸° â†’ ë³‘í•©)
```python
def next_step(self):
    """Go to next step (with preview animation)"""
    if self.step_manager and self.current_step < self.step_manager.get_num_steps() - 1:
        # 1. ë‹¤ìŒ ë‹¨ê³„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        next_step_num = self.current_step + 1
        next_step_info = self.step_manager.get_step(next_step_num)

        if next_step_info and next_step_info['merged_pair']:
            # 2. ë³‘í•©ë  í´ëŸ¬ìŠ¤í„° ì°¾ê¸°
            cluster_i, cluster_j = next_step_info['merged_pair']

            # 3. í˜„ì¬ ë‹¨ê³„ì—ì„œ í•´ë‹¹ í´ëŸ¬ìŠ¤í„°ì˜ ì¸ë±ìŠ¤ ì°¾ê¸°
            current_step_info = self.step_manager.get_step(self.current_step)
            current_labels = current_step_info['labels']

            idx_i = self._find_cluster_index(current_labels, cluster_i)
            idx_j = self._find_cluster_index(current_labels, cluster_j)

            if idx_i is not None and idx_j is not None:
                # 4. ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ í™œì„±í™”
                self.is_preview_mode = True
                self.preview_clusters = (idx_i, idx_j)
                self.update_step_display()  # ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í•˜ì´ë¼ì´íŠ¸

                # 5. 500ms í›„ ì‹¤ì œ ë³‘í•©
                QTimer.singleShot(500, self._complete_next_step)
            else:
                # Fallback: ë°”ë¡œ ë³‘í•©
                self._complete_next_step()
        else:
            # ë³‘í•© ì •ë³´ ì—†ìŒ: ë°”ë¡œ ì´ë™
            self._complete_next_step()
```

### 3. í—¬í¼ ë©”ì„œë“œ ì¶”ê°€

#### í´ëŸ¬ìŠ¤í„° ì¸ë±ìŠ¤ ì°¾ê¸°
```python
def _find_cluster_index(self, labels, cluster):
    """Find the index of a cluster in labels list"""
    cluster_set = set(cluster)
    for idx, label in enumerate(labels):
        if isinstance(label, (tuple, list)):
            # ë³‘í•©ëœ í´ëŸ¬ìŠ¤í„° (tuple/list)
            if set(label) == cluster_set:
                return idx
        else:
            # ë‹¨ì¼ í´ëŸ¬ìŠ¤í„°
            if {label} == cluster_set:
                return idx
    return None
```

#### ë³‘í•© ì™„ë£Œ
```python
def _complete_next_step(self):
    """Complete the transition to next step"""
    self.is_preview_mode = False
    self.preview_clusters = None
    self.step_slider.setValue(self.current_step + 1)
```

### 4. í…Œì´ë¸” í•˜ì´ë¼ì´íŠ¸ ë¡œì§ ìˆ˜ì •

#### populate_table ë©”ì„œë“œ

```python
def populate_table(self, matrix, labels):
    # ... í…Œì´ë¸” ì„¤ì • ...

    # í•˜ì´ë¼ì´íŠ¸ ê²°ì •
    if self.is_preview_mode and self.preview_clusters:
        # ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ: ë³‘í•©ë  í´ëŸ¬ìŠ¤í„° (ë¹¨ê°„ìƒ‰)
        highlight_indices = self.preview_clusters
        highlight_color = Qt.GlobalColor.red
    else:
        # ì¼ë°˜ ëª¨ë“œ: ì´ë¯¸ ë³‘í•©ëœ í´ëŸ¬ìŠ¤í„° (ë…¸ë€ìƒ‰)
        merged_idx = -1
        if self.current_step > 0:
            for idx, label in enumerate(labels):
                if isinstance(label, (tuple, list)):
                    merged_idx = idx
                    break
        highlight_indices = (merged_idx,) if merged_idx >= 0 else ()
        highlight_color = Qt.GlobalColor.yellow

    # í…Œì´ë¸” ì±„ìš°ê¸° (upper triangleë§Œ)
    for i in range(n):
        for j in range(n):
            if i < j:
                # Upper triangle
                value = matrix[i, j]
                item = QTableWidgetItem(f"{value:.3f}")

                # í•˜ì´ë¼ì´íŠ¸ ì ìš©
                should_highlight = False
                if self.is_preview_mode and self.preview_clusters:
                    # ë¯¸ë¦¬ë³´ê¸°: ë‘ í´ëŸ¬ìŠ¤í„° ëª¨ë‘ í•˜ì´ë¼ì´íŠ¸
                    idx_i, idx_j = self.preview_clusters
                    if i == idx_i or i == idx_j or j == idx_i or j == idx_j:
                        should_highlight = True
                elif highlight_indices:
                    # ì¼ë°˜: ë³‘í•©ëœ í´ëŸ¬ìŠ¤í„°ë§Œ í•˜ì´ë¼ì´íŠ¸
                    if any(i == idx or j == idx for idx in highlight_indices):
                        should_highlight = True

                if should_highlight:
                    item.setBackground(highlight_color)

                self.table.setItem(i, j, item)
            # ... diagonal, lower triangle ì²˜ë¦¬ ...
```

## ë™ì‘ íë¦„

### Step 0 â†’ Step 1 ì „í™˜ ì˜ˆì‹œ

```
í˜„ì¬ ìƒíƒœ (Step 0):
       J    T    Y    N    O    Q
J      -   0.9  0.8  0.4  0.35 0.36
T          -    0.8  0.38 0.33 0.34
Y               -    0.37 0.32 0.33
...

1. ì‚¬ìš©ì: Next ë²„íŠ¼ í´ë¦­

2. ì‹œìŠ¤í…œ: ë‹¤ìŒ ë‹¨ê³„ í™•ì¸
   - Step 1ì—ì„œ ë³‘í•©: (J) + (T)
   - í˜„ì¬ labels: ['J', 'T', 'Y', 'N', 'O', 'Q']
   - idx_i = 0 (Jì˜ ì¸ë±ìŠ¤)
   - idx_j = 1 (Tì˜ ì¸ë±ìŠ¤)

3. ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ í™œì„±í™” (0.0ì´ˆ)
       J    T    Y    N    O    Q
J      -   ğŸ”´  ğŸ”´  ğŸ”´  ğŸ”´  ğŸ”´   â† J í–‰ ë¹¨ê°„ìƒ‰
T      ğŸ”´   -   ğŸ”´  ğŸ”´  ğŸ”´  ğŸ”´   â† T í–‰ ë¹¨ê°„ìƒ‰
Y      ğŸ”´  ğŸ”´   -    0.37 0.32 0.33
N      ğŸ”´  ğŸ”´  0.37  -   0.75 0.75
...
       â†‘   â†‘
     Jì—´ Tì—´ë„ ë¹¨ê°„ìƒ‰

4. 0.5ì´ˆ ëŒ€ê¸° (ì‚¬ìš©ìê°€ í™•ì¸)

5. ë³‘í•© ì™„ë£Œ (0.5ì´ˆ í›„)
       J+T  Y    N    O    Q
J+T     -   0.8  0.39 0.34 0.35  â† ë³‘í•© ì™„ë£Œ, ë…¸ë€ìƒ‰
Y      0.8  -    0.37 0.32 0.33
N      0.39 0.37  -   0.75 0.75
...
```

## ìƒ‰ìƒ êµ¬ë¶„

| ìƒíƒœ | ìƒ‰ìƒ | ì˜ë¯¸ |
|------|------|------|
| ë¯¸ë¦¬ë³´ê¸° | ğŸ”´ ë¹¨ê°„ìƒ‰ | ë‹¤ìŒì— ë³‘í•©ë  í´ëŸ¬ìŠ¤í„° |
| ë³‘í•© ì™„ë£Œ | ğŸŸ¡ ë…¸ë€ìƒ‰ | í˜„ì¬ ë‹¨ê³„ì—ì„œ ë³‘í•©ëœ í´ëŸ¬ìŠ¤í„° |
| ì¼ë°˜ | â¬œ í°ìƒ‰ | ë³‘í•©ë˜ì§€ ì•Šì€ ì¼ë°˜ í´ëŸ¬ìŠ¤í„° |
| ëŒ€ê°ì„  | â¬› íšŒìƒ‰ | ëŒ€ê°ì„  (ìˆ¨ê¹€) |

## ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

### Before (ê°œì„  ì „)
```
ì‚¬ìš©ì: Next í´ë¦­
ì‹œìŠ¤í…œ: ì¦‰ì‹œ ë³‘í•©
ì‚¬ìš©ì: "ì–´? ë­ê°€ í•©ì³ì§„ ê±°ì§€? ğŸ¤”"
```

### After (ê°œì„  í›„)
```
ì‚¬ìš©ì: Next í´ë¦­
ì‹œìŠ¤í…œ: Jì™€ Të¥¼ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í•˜ì´ë¼ì´íŠ¸ (0.5ì´ˆ)
ì‚¬ìš©ì: "ì•„, Jì™€ Tê°€ í•©ì³ì§€ëŠ”êµ¬ë‚˜! ğŸ‘€"
ì‹œìŠ¤í…œ: ë³‘í•© ì™„ë£Œ (J+T)
ì‚¬ìš©ì: "ì´í•´í–ˆì–´! âœ…"
```

## ê¸°ìˆ ì  íŠ¹ì§•

### 1. QTimer.singleShot ì‚¬ìš©
```python
QTimer.singleShot(500, self._complete_next_step)
```
- **ë¹„ë™ê¸° ì²˜ë¦¬**: GUIê°€ freezeë˜ì§€ ì•ŠìŒ
- **ì •í™•í•œ íƒ€ì´ë°**: 500ms í›„ ì •í™•íˆ ì‹¤í–‰
- **ê¹”ë”í•œ ì½”ë“œ**: ì½œë°± íŒ¨í„´ìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„

### 2. ìƒíƒœ ê´€ë¦¬
```python
self.is_preview_mode = False  # ì´ˆê¸° ìƒíƒœ
self.preview_clusters = None  # ì´ˆê¸° ìƒíƒœ

# ë¯¸ë¦¬ë³´ê¸° í™œì„±í™”
self.is_preview_mode = True
self.preview_clusters = (idx_i, idx_j)

# ë³‘í•© ì™„ë£Œ í›„ ì´ˆê¸°í™”
self.is_preview_mode = False
self.preview_clusters = None
```
- **ëª…í™•í•œ ìƒíƒœ**: ë¯¸ë¦¬ë³´ê¸°/ì¼ë°˜ ëª¨ë“œ êµ¬ë¶„
- **ì•ˆì „í•œ ì´ˆê¸°í™”**: ë³‘í•© ì™„ë£Œ í›„ ë°˜ë“œì‹œ ì´ˆê¸°í™”

### 3. Prev ë²„íŠ¼ ì²˜ë¦¬
```python
def prev_step(self):
    """Go to previous step (immediate, no preview)"""
    if self.current_step > 0:
        self.is_preview_mode = False  # ë¯¸ë¦¬ë³´ê¸° ì·¨ì†Œ
        self.preview_clusters = None
        self.step_slider.setValue(self.current_step - 1)
```
- PrevëŠ” **ë¯¸ë¦¬ë³´ê¸° ì—†ìŒ** (ì¦‰ì‹œ ì´ë™)
- ì´ìœ : ì´ì „ ë‹¨ê³„ëŠ” ì´ë¯¸ ë³¸ ê²ƒì´ë¯€ë¡œ ë¶ˆí•„ìš”

## í–¥í›„ ê°œì„  ê°€ëŠ¥ì„±

### 1. ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
```python
# Fade in/out íš¨ê³¼
for alpha in range(0, 255, 25):
    color = QColor(255, 0, 0, alpha)  # íˆ¬ëª… â†’ ë¶ˆíˆ¬ëª…
    item.setBackground(color)
    QTimer.singleShot(alpha // 25 * 50, update_table)
```

### 2. íƒ€ì´ë° ì‚¬ìš©ì ì„¤ì •
```python
# ì„¤ì •ì—ì„œ ëŒ€ê¸° ì‹œê°„ ì¡°ì •
preview_delay_ms = settings.get('preview_delay', 500)
QTimer.singleShot(preview_delay_ms, self._complete_next_step)
```

### 3. ì†Œë¦¬ íš¨ê³¼
```python
# ë¯¸ë¦¬ë³´ê¸° ì‹œì‘ ì‹œ "ëµ" ì†Œë¦¬
QSound.play("sounds/preview.wav")

# ë³‘í•© ì™„ë£Œ ì‹œ "ë”¸ê¹" ì†Œë¦¬
QSound.play("sounds/merge.wav")
```

### 4. ì§„í–‰ ë°” í‘œì‹œ
```python
# 0.5ì´ˆ ë™ì•ˆ ì§„í–‰ ë°” í‘œì‹œ
progress_bar.setMaximum(500)
for ms in range(0, 500, 50):
    QTimer.singleShot(ms, lambda: progress_bar.setValue(ms))
```

## í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1. ì •ìƒ ë™ì‘
1. GUI ì‹¤í–‰
2. sample_local.csv ë¡œë“œ
3. Next ë²„íŠ¼ í´ë¦­
4. âœ… J, T í–‰/ì—´ì´ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í•˜ì´ë¼ì´íŠ¸
5. âœ… 0.5ì´ˆ í›„ J+Të¡œ ë³‘í•©
6. âœ… J+T í–‰/ì—´ì´ ë…¸ë€ìƒ‰ìœ¼ë¡œ í•˜ì´ë¼ì´íŠ¸

### 2. ì—°ì† í´ë¦­
1. Next í´ë¦­
2. 0.5ì´ˆ ì•ˆì— ë‹¤ì‹œ Next í´ë¦­
3. âœ… ë‘ ë²ˆì§¸ í´ë¦­ ë¬´ì‹œ (QTimer ì§„í–‰ ì¤‘)
4. âœ… ì²« ë²ˆì§¸ ë³‘í•© ì™„ë£Œ í›„ ë‹¤ìŒ í´ë¦­ ê°€ëŠ¥

### 3. Prev ì¤‘ë‹¨
1. Next í´ë¦­ (ë¯¸ë¦¬ë³´ê¸° ì‹œì‘)
2. 0.5ì´ˆ ì•ˆì— Prev í´ë¦­
3. âœ… ë¯¸ë¦¬ë³´ê¸° ì·¨ì†Œ
4. âœ… ì´ì „ ë‹¨ê³„ë¡œ ì¦‰ì‹œ ì´ë™

## ê²°ë¡ 

ë¯¸ë¦¬ë³´ê¸° ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ë¡œ:
- âœ… ì‚¬ìš©ìê°€ ë³‘í•© ê³¼ì •ì„ ëª…í™•íˆ ì´í•´
- âœ… ì‹œê°ì  í”¼ë“œë°±ìœ¼ë¡œ ì§ê´€ì„± í–¥ìƒ
- âœ… í•™ìŠµ/êµìœ¡ íš¨ê³¼ ì¦ê°€
- âœ… 0.5ì´ˆ ë”œë ˆì´ë¡œ ê³¼ì • ê´€ì°° ê°€ëŠ¥
- âœ… QTimerë¡œ ê¹”ë”í•˜ê²Œ êµ¬í˜„

**í´ëŸ¬ìŠ¤í„°ë§ ê³¼ì •ì„ ë” ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!**
