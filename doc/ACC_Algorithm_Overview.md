# ACC (Adaptive Cluster Circle) 알고리즘 개요 및 구현 방안

## 1. 개요

ACC(Adaptive Cluster Circle)는 두 종류의 덴드로그램(하위 local, 포괄 global)에서 유사도 정보를 결합해, 클러스터 간의 상대적 관계를 원형 도식으로 시각화하는 방법론이다. 각 클러스터는 두 개의 유사도 점수를 가진다:

- **첫 번째 점수 (sim_local)**: 하위 덴드로그램에서 해당 클러스터의 유사도
- **두 번째 점수 (sim_global)**: 포괄 덴드로그램에서의 대응 유사도 또는, 없을 경우 포괄 유사도 행렬에서의 평균 유사도

이 두 점수로부터 원의 지름과 각도를 산출하여, 점진적으로 클러스터를 결합해 나감으로써 전체 공간 구조를 도형적으로 재구성한다.

---

## 2. 데이터 입력 구조

1. **지역(또는 객체) 리스트**  
   예: `["J", "T", "Y", "N", "O", "Q"]`

2. **하위 덴드로그램 (local dendrogram)**  
   - 각 내부 노드는 (멤버 집합, 유사도)로 표현
   - 덴드로그램 구조를 순회하며 각 클러스터 추출

3. **포괄 덴드로그램 (global dendrogram)**  
   - 동일 멤버 집합의 클러스터가 존재할 경우, 해당 유사도를 sim_global로 사용
   - 존재하지 않을 경우 포괄 유사도 행렬에서 평균값을 계산

4. **포괄 유사도 행렬 (global similarity matrix)**  
   - 예: `matrix[a][b] = similarity (0~1)` 형태의 중첩 딕셔너리

---

## 3. 주요 연산 단계

### (1) 클러스터 추출

하위 덴드로그램을 순회하면서 모든 내부 노드에 대해 다음 정보를 추출한다.

```python
{
  "members": {"A", "B", ...},
  "sim_local": 0.85
}
```

### (2) 두 번째 점수 계산 (sim_global)

1. 동일 멤버셋이 포괄 덴드로그램에 존재하면 해당 유사도 사용.
2. 없을 경우, 포괄 유사도 행렬에서 멤버 간 유사도 평균을 계산.

```python
sim_global = 평균(matrix[a][b] for (a,b) in 모든 멤버쌍)
```

### (3) 도형 변수 계산

- **지름(d)** = `unit / sim_global`  (역수 변환)
- **각도(θ)** = `180° * (1 - sim_local)`  (유사도가 높을수록 각도 작음)

이로써 하나의 원(클러스터)을 표현할 수 있는 기초 정보가 완성된다.

### (4) 클러스터 정렬

`sim_local` 내림차순으로 정렬하여, 가장 유사도가 높은(가장 안쪽) 클러스터부터 배치한다.

---

## 4. 기하적 배치 알고리즘

### (1) 첫 번째 클러스터 배치

- 중심을 (0,0)에 둔다.
- 두 멤버가 있다면 ±θ/2의 각도로 배치.
- 세 개 이상일 경우 θ를 등분하여 배치.

### (2) 클러스터 확장 케이스 1 — 지역 하나 추가 ((A+B)+C)

1. 새로 추가된 멤버 C를 찾음.
2. 기존 클러스터 중심과 새 클러스터 중심을 일치시킴.
3. C와 기존 멤버 간의 유사도 중 최대값을 갖는 멤버 방향으로 배치.
4. 지름은 두 클러스터 중 큰 쪽으로, 각도는 작은 쪽으로 통일.
5. 각도를 비례적으로 축소하여 멤버 간 간격 유지.

### (3) 클러스터 확장 케이스 2 — 클러스터 병합 ((A+B)+(C+D))

1. 두 클러스터 중심을 일치시킴.
2. 각자의 중간선(midline)을 동일 각도로 회전.
3. 두 클러스터 간 멤버 쌍 중 유사도가 가장 높은 쌍을 찾아 근접 배치.
4. 지름/각도는 위와 동일하게 통합.

---

## 5. 구현 구조 (Python)

```python
class DendroNode:
    def __init__(self, members, sim, left=None, right=None):
        self.members = set(members)
        self.sim = sim
        self.left = left
        self.right = right
```

- `extract_clusters_from_dendro()` : 하위 덴드로그램 순회, 클러스터 추출
- `find_cluster_in_dendro_by_members()` : 포괄 덴드로그램에서 대응 클러스터 검색
- `average_pairwise_similarity()` : 포괄 유사도 행렬에서 평균 유사도 계산
- `decorate_clusters()` : 각 클러스터에 sim_global, d, θ 부여
- `place_first_cluster()` : 첫 클러스터 배치
- `add_area_to_cluster()` : 지역 하나 추가 케이스 구현
- `merge_two_clusters()` : 클러스터 병합 케이스 구현
- `build_acc()` : 전체 파이프라인 수행

---

## 6. 시각화 및 확장 방안

- `matplotlib` 또는 `svgwrite`를 이용해 원의 중심과 반지름을 시각적으로 표현 가능.
- 각 클러스터의 멤버를 텍스트로 표시하거나, 중심 좌표를 CSV로 저장하여 외부 도구로 활용 가능.
- 대규모 데이터셋에서는 NumPy 행렬 연산을 사용해 평균 유사도 계산을 벡터화하여 성능 향상.

---

## 7. 결론

ACC 알고리즘은 두 덴드로그램 간의 위계적 관계를 2차원 도형으로 직관적으로 표현할 수 있는 방법이다. 알고리즘 구현은 다음 세 가지 핵심 단계로 요약된다:

1. **클러스터별 이중 점수 계산 (sub + global)**
2. **도형 변수 변환 (지름, 각도)**
3. **순차적 배치 및 병합 (add / merge)**

이 구조는 계통, 지리, 생태 데이터의 복합적 상관관계를 시각화하는 데 유용하며, 향후 상호작용형 시각화 및 AI 보조형 패턴 분석으로 확장 가능하다.
